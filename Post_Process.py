import numpy as np
from rocketpy import Environment
from Udp import Udp

Env = Environment(
            railLength=7.3152,
            latitude=32.990254,
            longitude=-106.974998,
            elevation=615,
            )

"""
-------------------------------------------------------- Post Process Settings -------------------------------------------------------- 
"""


post_process = Udp(
    lower_bounds = {},
    upper_bounds = {},
    decision_dict = {},
    Env = Env,
    num_int = 0,
    num_constraints = 0,
    identical_motors = True,
    identical_fins = True,
    post_process = True, 
    data_output = True)

"""
-------------------------------------------------------- Test/Optimized Rockets -------------------------------------------------------- 
"""


# 114.5498 km
# x0 = [300,7.499078445,3.530360566,83.78064947,300,7.499078445,3.530360566,83.78064947,12.57888055,8.002224346,4.102576699,13.30347278,12.57888055,8.002224346,4.102576699,13.30347278,15.42680838,7,7,2,2,2,8.75]


# x0 = [499.7287309,7.49889255,2.985788973,89.98307033,499.7287309,7.49889255,2.985788973,89.98307033,11.71592637,8.000340042,3.104042052,13.31567967,11.71592637,8.000340042,3.104042052,13.31567967,15.88582886,8,8,2,2,2,8.75]

#idk what this one is
# x0 = [499.2706989,7.493661269,4.076671908,74.86629839,499.2706989,7.493661269,4.076671908,74.86629839,12.02913552,8.078355651,3.141325087,13.33083583,12.02913552,8.078355651,3.141325087,13.33083583,19.25728293,7,7,2,2,2,8.75]

# mbs
# x0 = [499, 5, 2.329, 53.3945, 499, 5, 2.329, 53.3945, 13, 7.2, 4.3, 7.6, 16.9, 7.2, 3.3, 13.5, 12, 5, 5, 5, 4, 3, 6]




# new casing thickness set up
# 114.7 km
x0 = [403.9213579,7.484993549,3.628403419,79.8242081,403.9213579,7.484993549,3.628403419,79.8242081,13.00729738,8.005620778,3.505618939,13.31494602,13.00729738,8.005620778,3.505618939,13.31494602,16.20458552,7,7,2,2,2,8.75]

x0 = [409.3308409,7.455488181,3.648120682,79.93047366,409.3308409,7.455488181,3.648120682,79.93047366,16.80787935,11.77965025,3.210853025,12.59295695,19.71030354,8.465247638,5.991434996,13.26091857,16.0771427,7,7,4,3,2,8.75]



# idk wtf this is
# x0 = [6.292628385,7.499078445,3.530360566,83.78064947,6.292628385,7.499078445,3.530360566,83.78064947,12.57888055,8.002224346,4.102576699,13.30347278,12.57888055,8.002224346,4.102576699,13.30347278,15.42680838,7,7,2,2,2,8.75]
"""
-------------------------------------------------------- Post Process Code -------------------------------------------------------- 
"""

dict = {
        'MEOP_1': 0,
        'odia_1': 0,
        'dia_1': 0,
        'length_1': 0,
        'MEOP_2': 0,
        'odia_2': 0,
        'dia_2': 0,
        'length_2': 0,
        'root_1': 0,
        'span_1': 0,
        'tip_1': 0,
        'sweep_1': 0,
        'root_2': 0,
        'span_2': 0, 
        'tip_2': 0,
        'sweep_2': 0,
        'ignitionDelay': 0,
        'number_1': 0,
        'number_2': 0,
        'diachute_1': 0,
        'diachute_2': 0,
        'diachute_3': 0,
        'diameter': 0,
    }

for i, key in enumerate(dict.keys()):
    dict[key] = x0[i]

viable_diams = [6, 7.76, 8.75, 11.67] 
dict["diameter"] = viable_diams.index(dict["diameter"])


d_f = post_process.fitness(dict)

print("Constraints Met: ", np.all(np.array(d_f) <= 0))